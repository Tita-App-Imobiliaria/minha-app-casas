<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Portf√≥lio Imobili√°rio</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/25/25694.png">
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #000; --bg: #fdfdfb; --card: #ffffff; }
        
        /* For√ßar o fundo em todo o lado */
        html, body { background-color: var(--bg) !important; height: 100%; margin: 0; }
        
        body { font-family: 'Georgia', serif; padding: 20px; color: #1a1a1a; text-align: center; }
        .container { max-width: 600px; margin: auto; padding-bottom: 50px; }
        
        .brand-text { font-size: 24px; line-height: 1.4; margin: 40px 0; }
        .brand-text b { font-size: 32px; display: block; margin-top: 10px; font-family: sans-serif; letter-spacing: 4px; font-weight: bold; }
        
        .intro-text { font-size: 14px; color: #666; line-height: 1.6; margin-bottom: 30px; padding: 0 20px; font-style: italic; }

        details { background: var(--card); border: 1px solid #e5e5e0; margin-bottom: 15px; text-align: left; }
        summary { padding: 20px; font-weight: bold; cursor: pointer; list-style: none; display: flex; justify-content: space-between; text-transform: uppercase; font-size: 12px; letter-spacing: 1px; outline: none; }
        summary::after { content: "Ôºã"; color: #999; }
        details[open] summary::after { content: "Ôºç"; }
        
        .details-content { padding: 0 20px 20px 20px; border-top: 1px solid #f9f9f9; }
        input { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-size: 16px; background: #fff; }
        
        .btn-add { background: #000; color: #fff; width: 100%; padding: 18px; border: none; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; margin-top: 10px; }
        
        .icon-box { font-size: 50px; padding: 30px; background: #f9f9f7; display: block; text-align: center; margin-bottom: 15px; }
        
        .btn-wa { background: #000; color: white; text-decoration: none; display: block; text-align: center; padding: 15px; margin-top: 20px; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; font-family: sans-serif; }
        
        .logout-container { margin-top: 60px; padding: 20px; border-top: 1px solid #eee; }
        .btn-logout { background: #f0f0ed; color: #888; border: none; padding: 10px 20px; font-size: 11px; text-transform: uppercase; cursor: pointer; letter-spacing: 1px; }

        #app-content { display: none; }
        textarea { width: 100%; min-height: 100px; border: 1px solid #ddd; padding: 10px; margin-top: 15px; box-sizing: border-box; font-family: 'Georgia', serif; font-size: 15px; background: #fff; }
        
        h2#welcome-user { font-weight: normal; font-style: italic; margin-bottom: 40px; font-size: 26px; }
    </style>
</head>
<body>
<div class="container">
    <div id="login-screen">
        <div class="brand-text">
            New Beginnings<br>New Memories<br>New Dreams<b>NEW HOME</b>
        </div>
        
        <p class="intro-text">
            Bem-vindo ao seu espa√ßo exclusivo de consultoria. Aqui poder√° acompanhar a sele√ß√£o de im√≥veis curada especificamente para si, centralizar as suas notas e comunicar diretamente connosco sobre cada oportunidade.
        </p>

        <input type="text" id="access-code" placeholder="INSIRA O SEU C√ìDIGO">
        <button class="btn-add" onclick="checkLogin()">Aceder ao Portf√≥lio</button>
    </div>

    <div id="app-content">
        <h2 id="welcome-user">Ol√°! üëã</h2>

        <details>
            <summary>Adicionar Im√≥vel</summary>
            <div class="details-content">
                <input type="text" id="link-in" placeholder="Link do Im√≥vel">
                <input type="text" id="local-in" placeholder="Localiza√ß√£o">
                <input type="text" id="preco-in" placeholder="Valor">
                <input type="text" id="tipo-in" placeholder="Tipologia">
                <button class="btn-add" onclick="saveToFirebase()">Gravar na Lista</button>
            </div>
        </details>

        <div id="property-list"></div>
        
        <div class="logout-container">
            <button class="btn-logout" onclick="location.reload()">Terminar Sess√£o</button>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA18c4ynE28ugvLZqyatw1-l-s2U98UqzE",
        authDomain: "app-imobiliaria-compradores.firebaseapp.com",
        databaseURL: "https://app-imobiliaria-compradores-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "app-imobiliaria-compradores",
        storageBucket: "app-imobiliaria-compradores.firebasestorage.app",
        messagingSenderId: "125952001601",
        appId: "1:125952001601:web:9b3ceb8cadd48ec9d568c0"
    };
    const SEU_TELEM√ìVEL = "351960012080";
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    let currentCode = "";

    function checkLogin() {
        const codeInput = document.getElementById('access-code');
        const code = codeInput.value.trim();
        if(code !== "") { 
            currentCode = code.toLowerCase(); 
            // Formatar o nome para a sauda√ß√£o (Primeira letra mai√∫scula)
            const nomeFormatado = code.charAt(0).toUpperCase() + code.slice(1);
            document.getElementById('welcome-user').innerText = "Ol√° " + nomeFormatado + " üëã";
            
            document.getElementById('login-screen').style.display = 'none'; 
            document.getElementById('app-content').style.display = 'block'; 
            loadData(); 
        } else {
            alert("Por favor, insira o seu c√≥digo de acesso.");
        }
    }

    function saveToFirebase() {
        const link = document.getElementById('link-in').value;
        if(!link) return alert("Por favor, cole o link do im√≥vel.");
        database.ref('clientes/' + currentCode).push({
            link: link, 
            local: document.getElementById('local-in').value || "Localiza√ß√£o sob consulta",
            preco: document.getElementById('preco-in').value || "Valor sob consulta",
            tipo: document.getElementById('tipo-in').value || "N/A", 
            notas: ""
        });
        alert("Im√≥vel adicionado com sucesso!");
        document.getElementById('link-in').value = "";
        document.getElementById('local-in').value = "";
        document.getElementById('preco-in').value = "";
        document.getElementById('tipo-in').value = "";
    }

    function loadData() {
        database.ref('clientes/' + currentCode).on('value', (snapshot) => {
            const listDiv = document.getElementById('property-list');
            listDiv.innerHTML = "";
            const items = snapshot.val();
            if(!items) return;
            Object.keys(items).reverse().forEach(id => {
                const item = items[id];
                // Criar mensagem personalizada para o WhatsApp
                const msgWa = encodeURIComponent("Ol√°! Tenho interesse no im√≥vel em " + item.local + " (" + item.preco + ") que vi na app.");
                
                listDiv.innerHTML += `
                <details>
                    <summary>${item.local} ‚Äî ${item.preco}</summary>
                    <div class="details-content">
                        <span class="icon-box">üè†</span>
                        <p><strong>Configura√ß√£o:</strong> ${item.tipo}</p>
                        <a href="${item.link}" target="_blank" style="color: #666; font-size: 13px;">Consultar Detalhes Online üîó</a>
                        <textarea onchange="updateNote('${id}', this.value)" placeholder="As suas notas sobre este im√≥vel...">${item.notas || ''}</textarea>
                        <a href="https://wa.me/${SEU_TELEM√ìVEL}?text=${msgWa}" target="_blank" class="btn-wa">Enviar Feedback</a>
                    </div>
                </details>`;
            });
        });
    }

    function updateNote(id, note) { 
        database.ref('clientes/' + currentCode + '/' + id).update({ notas: note }); 
    }
</script>
</body>
</html>
