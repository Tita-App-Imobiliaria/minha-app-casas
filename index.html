<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Portf√≥lio Imobili√°rio</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/25/25694.png">
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { 
            --primary: #000; 
            --bg: #e8f1f2; /* Azul/Esverdeado Pastel */
            --card: #ffffff; 
        }
        
        /* For√ßar o fundo em toda a p√°gina */
        html, body { 
            background-color: var(--bg) !important; 
            min-height: 100vh; 
            margin: 0; 
            padding: 0;
            -webkit-font-smoothing: antialiased;
        }
        
        body { font-family: 'Georgia', serif; padding: 20px; color: #1a1a1a; text-align: center; }
        .container { max-width: 600px; margin: auto; padding-bottom: 60px; }
        
        .brand-text { font-size: 24px; line-height: 1.4; margin: 40px 0; }
        .brand-text b { font-size: 32px; display: block; margin-top: 10px; font-family: sans-serif; letter-spacing: 4px; font-weight: bold; }
        
        .intro-text { font-size: 14px; color: #4a5a5a; line-height: 1.6; margin-bottom: 30px; padding: 0 20px; font-style: italic; }

        details { background: var(--card); border: 1px solid #d1dbdb; margin-bottom: 15px; text-align: left; border-radius: 4px; }
        summary { padding: 20px; font-weight: bold; cursor: pointer; list-style: none; display: flex; justify-content: space-between; text-transform: uppercase; font-size: 11px; letter-spacing: 1px; outline: none; font-family: sans-serif; }
        summary::after { content: "Ôºã"; color: #8ea1a1; }
        details[open] summary::after { content: "Ôºç"; }
        
        .details-content { padding: 0 20px 20px 20px; border-top: 1px solid #f0f5f5; }
        input { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ccd6d6; border-radius: 4px; box-sizing: border-box; font-size: 16px; background: #fff; }
        
        .btn-add { background: #000; color: #fff; width: 100%; padding: 18px; border: none; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; margin-top: 10px; border-radius: 4px; }
        
        .icon-box { font-size: 50px; padding: 30px; background: #f4f8f8; display: block; text-align: center; margin-bottom: 15px; border-radius: 4px; }
        
        .btn-wa { background: #000; color: white; text-decoration: none; display: block; text-align: center; padding: 15px; margin-top: 20px; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; font-family: sans-serif; border-radius: 4px; }
        
        .logout-container { margin-top: 60px; padding: 20px; }
        .btn-logout { background: rgba(0,0,0,0.05); color: #6a7a7a; border: none; padding: 10px 20px; font-size: 10px; text-transform: uppercase; cursor: pointer; letter-spacing: 1px; border-radius: 20px; }

        #app-content { display: none; }
        textarea { width: 100%; min-height: 100px; border: 1px solid #ccd6d6; padding: 10px; margin-top: 15px; box-sizing: border-box; font-family: 'Georgia', serif; font-size: 15px; background: #fff; border-radius: 4px; }
        
        h2#welcome-user { font-weight: normal; font-style: italic; margin-bottom: 40px; font-size: 28px; color: #2c3e3e; }
    </style>
</head>
<body>
<div class="container">
    <div id="login-screen">
        <div class="brand-text">
            New Beginnings<br>New Memories<br>New Dreams<b>NEW HOME</b>
        </div>
        <p class="intro-text">
            Bem-vindo ao seu espa√ßo exclusivo de consultoria. Aqui poder√° acompanhar a sele√ß√£o de im√≥veis especificamente para si, centralizar as suas notas e comunicar diretamente connosco.
        </p>
        <input type="text" id="access-code" placeholder="C√ìDIGO DE ACESSO">
        <button class="btn-add" onclick="checkLogin()">Aceder ao Portf√≥lio</button>
    </div>

    <div id="app-content">
        <h2 id="welcome-user">Ol√°! üëã</h2>
        <details>
            <summary>Adicionar Im√≥vel</summary>
            <div class="details-content">
                <input type="text" id="link-in" placeholder="Link do Im√≥vel">
                <input type="text" id="local-in" placeholder="Localiza√ß√£o">
                <input type="text" id="preco-in" placeholder="Valor">
                <input type="text" id="tipo-in" placeholder="Tipologia">
                <button class="btn-add" onclick="saveToFirebase()">Gravar na Lista</button>
            </div>
        </details>
        <div id="property-list"></div>
        <div class="logout-container">
            <button class="btn-logout" onclick="location.reload()">Terminar Sess√£o</button>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA18c4ynE28ugvLZqyatw1-l-s2U98UqzE",
        authDomain: "app-imobiliaria-compradores.firebaseapp.com",
        databaseURL: "https://app-imobiliaria-compradores-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "app-imobiliaria-compradores",
        storageBucket: "app-imobiliaria-compradores.firebasestorage.app",
        messagingSenderId: "125952001601",
        appId: "1:125952001601:web:9b3ceb8cadd48ec9d568c0"
    };
    const SEU_TELEM√ìVEL = "351960012080";
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    let currentCode = "";

    function checkLogin() {
        const codeInput = document.getElementById('access-code');
        const codeOriginal = codeInput.value.trim();
        if(codeOriginal !== "") { 
            currentCode = codeOriginal.toLowerCase(); 
            
            // L√≥gica para extrair apenas o primeiro nome
            // Divide por espa√ßo ou tra√ßo e pega na primeira parte
            let primeiroNome = codeOriginal.split(/[ -]+/)[0];
            primeiroNome = primeiroNome.charAt(0).toUpperCase() + primeiroNome.slice(1).toLowerCase();
            
            document.getElementById('welcome-user').innerText = "Ol√° " + primeiroNome + " üëã";
            document.getElementById('login-screen').style.display = 'none'; 
            document.getElementById('app-content').style.display = 'block'; 
            loadData(); 
        }
    }

    function saveToFirebase() {
        const link = document.getElementById('link-in').value;
        if(!link) return alert("Por favor, cole o link.");
        database.ref('clientes/' + currentCode).push({
            link: link, 
            local: document.getElementById('local-in').value || "Localiza√ß√£o sob consulta",
            preco: document.getElementById('preco-in').value || "Valor sob consulta",
            tipo: document.getElementById('tipo-in').value || "N/A", 
            notas: ""
        });
        alert("Im√≥vel adicionado!");
        document.getElementById('link-in').value = "";
        document.getElementById('local-in').value = "";
        document.getElementById('preco-in').value = "";
        document.getElementById('tipo-in').value = "";
    }

    function loadData() {
        database.ref('clientes/' + currentCode).on('value', (snapshot) => {
            const listDiv = document.getElementById('property-list');
            listDiv.innerHTML = "";
            const items = snapshot.val();
            if(!items) return;
            Object.keys(items).reverse().forEach(id => {
                const item = items[id];
                const msgWa = encodeURIComponent("Ol√°! Gostaria de feedback sobre este im√≥vel: " + item.local + " (" + item.preco + ")");
                listDiv.innerHTML += `
                <details>
                    <summary>${item.local} ‚Äî ${item.preco}</summary>
                    <div class="details-content">
                        <span class="icon-box">üè†</span>
                        <p style="font-size:14px;"><strong>Tipologia:</strong> ${item.tipo}</p>
                        <a href="${item.link}" target="_blank" style="color: #4a5a5a; font-size: 13px;">Abrir link do an√∫ncio üîó</a>
                        <textarea onchange="updateNote('${id}', this.value)" placeholder="Escreva aqui as suas notas ou d√∫vidas...">${item.notas || ''}</textarea>
                        <a href="https://wa.me/${SEU_TELEM√ìVEL}?text=${msgWa}" target="_blank" class="btn-wa">Enviar Feedback</a>
                    </div>
                </details>`;
            });
        });
    }

    function updateNote(id, note) { 
        database.ref('clientes/' + currentCode + '/' + id).update({ notas: note }); 
    }
</script>
</body>
</html>
